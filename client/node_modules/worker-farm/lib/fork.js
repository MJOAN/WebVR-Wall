'use strict'

const childProcess = require('child_process')
    , childModule  = require.resolve('./child/index')


<<<<<<< HEAD
function fork (forkModule, workerOptions) {
=======
function fork (forkModule) {
>>>>>>> dd91e06c... first commit
  // suppress --debug / --inspect flags while preserving others (like --harmony)
  let filteredArgs = process.execArgv.filter(function (v) {
        return !(/^--(debug|inspect)/).test(v)
      })
<<<<<<< HEAD
    , options       = Object.assign({
          execArgv : filteredArgs
        , env      : process.env
        , cwd      : process.cwd()
      }, workerOptions)
    , child         = childProcess.fork(childModule, process.argv, options)
=======
    , child        = childProcess.fork(childModule, process.argv, {
          execArgv: filteredArgs
        , env: process.env
        , cwd: process.cwd()
      })
>>>>>>> dd91e06c... first commit

  child.on('error', function() {
    // this *should* be picked up by onExit and the operation requeued
  })

<<<<<<< HEAD
  child.send({ owner: 'farm', module: forkModule })
=======
  child.send({ module: forkModule })
>>>>>>> dd91e06c... first commit

  // return a send() function for this child
  return {
      send  : child.send.bind(child)
    , child : child
  }
}


module.exports = fork
