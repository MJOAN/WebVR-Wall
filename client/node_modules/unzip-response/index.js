'use strict';
<<<<<<< HEAD
const PassThrough = require('stream').PassThrough;
const zlib = require('zlib');

module.exports = res => {
=======
var PassThrough = require('stream').PassThrough;
var zlib = require('zlib');

module.exports = function (res) {
>>>>>>> dd91e06c... first commit
	// TODO: use Array#includes when targeting Node.js 6
	if (['gzip', 'deflate'].indexOf(res.headers['content-encoding']) === -1) {
		return res;
	}

<<<<<<< HEAD
	const unzip = zlib.createUnzip();
	const stream = new PassThrough();
=======
	var unzip = zlib.createUnzip();
	var stream = new PassThrough();
>>>>>>> dd91e06c... first commit

	stream.httpVersion = res.httpVersion;
	stream.headers = res.headers;
	stream.rawHeaders = res.rawHeaders;
	stream.trailers = res.trailers;
	stream.rawTrailers = res.rawTrailers;
	stream.setTimeout = res.setTimeout.bind(res);
	stream.statusCode = res.statusCode;
	stream.statusMessage = res.statusMessage;
	stream.socket = res.socket;

<<<<<<< HEAD
	unzip.on('error', err => {
=======
	unzip.on('error', function (err) {
>>>>>>> dd91e06c... first commit
		if (err.code === 'Z_BUF_ERROR') {
			stream.end();
			return;
		}

		stream.emit('error', err);
	});

	res.pipe(unzip).pipe(stream);

	return stream;
};
