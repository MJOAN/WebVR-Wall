var xhr = require('xhr')
var normalize = require('./normalize-response')
<<<<<<< HEAD
var noop = function () {}
=======
>>>>>>> dd91e06c... first commit

module.exports = xhrRequest
function xhrRequest (opt, cb) {
  delete opt.uri

  // for better JSON.parse error handling than xhr module
  var useJson = false
  if (opt.responseType === 'json') {
    opt.responseType = 'text'
    useJson = true
  }

<<<<<<< HEAD
  var req = xhr(opt, function xhrRequestResult (err, resp, body) {
=======
  return xhr(opt, function xhrRequestResult (err, resp, body) {
>>>>>>> dd91e06c... first commit
    if (useJson && !err) {
      try {
        var text = resp.rawRequest.responseText
        body = JSON.parse(text)
      } catch (e) {
        err = e
      }
    }

    resp = normalize(opt, resp)
    if (err) cb(err, null, resp)
    else cb(err, body, resp)
<<<<<<< HEAD
    cb = noop
  })

  // Patch abort() so that it also calls the callback, but with an error
  var onabort = req.onabort
  req.onabort = function () {
    var ret = onabort.apply(req, Array.prototype.slice.call(arguments))
    cb(new Error('XHR Aborted'))
    cb = noop
    return ret
  }

  return req
=======
  })
>>>>>>> dd91e06c... first commit
}
